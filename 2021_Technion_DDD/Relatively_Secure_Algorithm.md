# Relatively Secure Algorithm
Category: Cryptography, 100 points

## Description

> We found this file on one of the faculty's computers, can you figure out what it is?

```
n: 64688515842284381671285004713804057636974557043123767909276429885604529285055404207075465905227143695430455279800518929093831790936189708370062485183802100838287376867856559903530579349374796297159049065333233931788848350374173712353230060293523474403987407765649434254998522278378495084980700748935618891923962239344544154272491020249558215375977606486760460422202116533788408155245251359521777496616339405771279249068498668116863069351420020125562376739789157649944067345626979176860652958691999120437343723606888389461284256787402625251235241451411378545300689504397171479953543369035178883526250835923703615578136066684839630468512969083190896398779217095068726488419589358409070454386485844997512703281268502500904561738131008765847551172137972586469740509371675414288404281022456568352136696484283422736887811386820703315621810671355735245976200449110198324297579063662473065418084750048169016026532746592187197223016440024737743946165469032386005490490777351422019715144641826330155082800871042763249387422682239874216066638266888151007585252882687342656759731162027247188605648618213032769015693624797403843186368832529467616755553007077348968460557923432409793346685045600037583739794581285620144710211799130766036576699501229814477038586532407516082567813449345012514324236599197601215293935631469950279433487156213490137438955911443975101487007277541610916632919492197556190435604801295384189903757992369143122734749876437785266527123465057030823398306626678265572569955990069442076473575637262453172104176942861509829663820711953
e: 65537
c: 24715967685667908755682143552558301228895312856211439254751278856867878822964565163534510469936883475207381551974263121288818638815590209829046605705934884999799688011188009729082903829082870627331532547086642464951949279593609910113030150833000695261470152359233914523508358790960728100932841856192486816774999547660137998025855054463626455166680450815005634311609262714477388320655298195005372476666536344433868302715671653367396357979323660932473642853195202942908928916112439518280638675390127960040234256408831855808991407641499245314300208714360285350544849965807918228311619616815547521337911167590562212366417466162226443285490382429794073515122796613960489756521974327788417877937398348904790717154292050633465186458177127847198714850112602023951651380018700866140645706146487547682120601474189742409942928804526991649478343057631302061542546856756336249425712037804186270745139317426342565606602358076267515330051294412355034202584625120525189906061509752862456253790575835529817600288958034138055806341374192687343961164073740105171251649685229987579568602088627287970037488651160912111961547302445627842762654485495100388400925879614578755424340717930964599631708087549274389877839616079093186662873897681760959522420756566179048190110035556928426843206576658026137330265525476055769521706260856523778437320323643528914761561220779422057582174267224786127758596199130903736855530483273104550604941266288619364648307969406683695314328473918200752704899649476756898042631730322277193245007417103723086092182980256619512655253112468

```

## Solution

If we search for `n` in [FactorDB](http://factordb.com/) we'll find that the website has already factorized it into multiple prime factors. RSA is pretty much similar when multiple primes are used instead of just two:

```python
import gmpy2
import functools
from factordb.factordb import FactorDB

with open("message.txt") as f:
    params = {}
    for line in f:
        name, value = line.strip().split(": ")
        params[name] = int(value)
        
    c = params["c"]
    e = params["e"]
    n = params["n"]

    f = FactorDB(n)
    f.connect()
    r = f.get_factor_list()

    assert(n == functools.reduce(lambda x, y: x * y, r))

    phi_n = 1
    for i in range(len(r)):
        phi_n *= (r[i] - 1)
    print("phi_n: {}".format(phi_n))

    d = gmpy2.invert(e, phi_n)
    print("d: {}".format(d))

    plaintext = pow(c, d, n)
    print("plaintext: {}".format(str(plaintext)))

    plaintext_decoded = bytes.fromhex(format(plaintext, 'x'))

    print("Flag: {}".format(plaintext_decoded))
```


Output:

```console
┌──(user@kali)-[/media/sf_CTFs/ducky_debug_duck/Relatively_Secure_Algorithm]
└─$ python3 solve.py
phi_n: 64688515842284381671285004713804057636974557043123767909276429885604529285055404207075465905227143695430455279800518929093831790936189708370062485183802100838287376867856559903530579349374796297159049065333233931788848350374173712353230060293523474403987407765649434254998522278378495084980700748935618891921722776338730326433769542747617648882227321346160321997467043890511528366767224588156728337344114863198239096213292953790521527859014576988657739632907021832860777375604194573376276890630770813858497094137480237618085048615465508500107258429723334667113325326881304262766539396746586423149858585710231051588618823397698281040046381902152189630943833701589041142580172471074065262383603093807060928023015970934225318139269931953581781846989345698741217637762880743695015785511196590211532988551139442182565147574442514162796230730031975714417556470557108218293729322509932259360911570494352736676528542646881661916445330144724872748500371480296738411295549774849944540471045261027289622644900202112347287917143351175505377868033530852802108356563322545327918706732258958301053363356043426684801366017476639681532148349890136083984309930879477854150384943977367126717331022520761345700863096252056669185952208283830048189856635887260651023404723854385259539496967661500605710591643511273851103319608086960327225749989814896999942193927403836786546641377383892100210004069994291343365729927845871828749806987838905361021820708339256790512621039679838325195921723654732180190980586909199055437107765490601990274911576612270753540374240000
d: 30697359395380384667851193167207931283243186658546304865625478270935515216827487844119306493317731494085587671113968272804952449732448844626835883382154284390050466463071837481114500477067246972574979415167974964960757796307990943347810471567642401299479811122140125506667287835231566857544589976530780285010994985185994371913426503798631443005283575596465904971561485344079047442001627854367368834267695687099886108491896346535319277910422407866506793148655086119321454695535200745105851828716861808001575592835736078702449685093015812660837934863731872196579404270351230031463743766709169442604339564148316000189298341511946176058492797612904666028691475473693015846533154765253268072388575250887278863260689331157276155364622959301713435394378269545918364718165701681934098157214981063453906586263338826187920962045335645367700120171872292670070128419584754651402032163969343931918219476667750585327983241166333821896050319170864451263841212643807750806281819399695336606934243368142403638620266357716923274703192978341367735045788528762716413169493863484134126856270095573541095253068845851502164006334490799000498189018136064089169660479581789847934403035807194678439797287034738817023923009802691035776479144263959511401262513940122468938582585590908671005361180619690691328553338010598849036624194142308408635134728218308691246200331755486581039726365818378081336208959470565646561090693135276467859667017437324819991434213182643181484390715687977354984103111306012951522643640277646072052337633806212092368429284719190997987482473473
plaintext: 46484042852512501777975836148161753489665014689134403201615570586404791913114928273134032916595772456211705243532707835859174461388150685079314397693486333548790588842720237461997728244540669640364499489931741081250270876792484568519957499528584496088293608867192651423921031768146046102012699308047603552792813795005796542317106233028092773512487917548143441567388132562642269208199086123122082239415711713465565319951923575659497544114614391366283295065359582722957207281578178025788201031177072945707423705076355136535127425203989706591638097839573510733400769668330343323297265520152439444731043169584698052888937914443778974229564534980078678643448266344758286056470340278054497582641226129162747107716094674099849309376964332939223641502512253630236695464185650952889522299809911017958359349047618311518819584203708432771938018999878837029434399718074324890547096090454711291434616302131168019477495906352348399449931220378277800974439850292667954359022534126155349498969061921854442581642672009387590141156169740431444166788664126784986407504050049880891603314462992827238517108947566152430114680078929488652682101493406312373797294561045460361597746905247426705722232526586321566189211811335374018492790752927812330222934301570522979627939218437503171303395881709181399755233179022242941853233505818092197473032962651196209057968215173112173342976893
Flag: b"CTF or Capture the Flag are a type of computer security competition where each participant or team competes to collect points by solving challenges in a number of areas in computer security. In order to solve a challenge a team must retrieve a flag. Flags are strings with certain fixed formats that are placed on servers, encrypted, hidden, returned after showing a specific ability and more. Submitting this flag to the website will yield points which will move the participants up the leaderboard. Anyways, here's the flag: flag{Rs4_1s_s1mpl3_t0_us3_4nd_4t7ack}"
```